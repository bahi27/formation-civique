<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Formation Civique Officielle</title>
    <style>
        :root {
            --bleu-france: #000091;
            --bg-light: #f6f6f6;
            --jaune-focus: #ffe800;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: white;
            overflow: hidden;
        }

        /* En-tête */
        header {
            background: white;
            border-bottom: 2px solid var(--bleu-france);
            padding: 15px;
            text-align: center;
            flex-shrink: 0;
        }

        h1 { font-size: 1rem; color: var(--bleu-france); margin: 0; text-transform: uppercase; font-weight: 900; }

        /* Navigation Thématique */
        .theme-nav {
            background: var(--bleu-france);
            padding: 10px;
            flex-shrink: 0;
        }

        select {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border-radius: 0;
            border: 2px solid white;
            background: white;
            font-weight: bold;
            color: var(--bleu-france);
        }

        /* Zone de Lecture */
        main {
            flex: 1;
            overflow-y: auto;
            background-color: var(--bg-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 15px;
        }

        .content-container {
            width: 100%;
            max-width: 600px;
            text-align: center;
        }

        /* 1/3 sur ordinateur */
        @media (min-width: 1025px) { .content-container { max-width: 33.33vw; } }

        .desc-img {
            width: 100%;
            max-height: 250px;
            object-fit: contain;
            background: white;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }

        #content-area {
            line-height: 1.6;
            font-size: 1.8rem;
            font-weight: 500;
            color: #161616;
            padding-bottom: 60px;
        }

        .highlight { background-color: var(--jaune-focus); color: black; padding: 2px 4px; }

        /* Contrôles Mobile */
        footer {
            background: white;
            border-top: 3px solid var(--bleu-france);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex-shrink: 0;
        }

        .btn-row {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        button {
            border: 2px solid var(--bleu-france);
            background: var(--bleu-france);
            color: white;
            padding: 20px 10px;
            font-weight: 900;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 0 !important;
            font-size: 0.9rem;
            flex: 1;
        }

        .btn-nav {
            flex: 0 0 70px;
            font-size: 2rem;
            background: white;
            color: var(--bleu-france);
        }

        /* Écran d'accueil pour débloquer l'audio */
        #welcome-screen {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: var(--bleu-france);
            color: white; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 1000;
            padding: 30px; text-align: center;
        }
    </style>
</head>
<body>

    <div id="welcome-screen" onclick="initApp()">
        <h1 style="color:white; font-size: 2rem; margin-bottom: 20px;">FORMATION CIVIQUE</h1>
        <p style="font-size: 1.2rem; margin-bottom: 30px;">Cliquez pour activer la voix fluide et commencer la lecture.</p>
        <button style="background:white; color:var(--bleu-france); padding: 25px 50px; font-size: 1.5rem; max-width: 300px;">COMMENCER</button>
    </div>

    <header><h1 id="current-title">Chargement...</h1></header>

    <div class="theme-nav">
        <select id="theme-select" onchange="filterTheme()">
            <option value="devise">1. DEVISE ET SYMBOLES</option>
            <option value="laicite">2. LA LAÏCITÉ</option>
            <option value="langue">3. LA LANGUE FRANÇAISE</option>
            <option value="contrat">4. CONTRAT D'ENGAGEMENT</option>
        </select>
    </div>

    <main id="scroll-target">
        <div class="content-container">
            <img id="main-img" class="desc-img" src="" style="display:none;">
            <div id="content-area"></div>
        </div>
    </main>

    <footer>
        <div class="btn-row">
            <button class="btn-nav" onclick="changePage(-1)">←</button>
            <button onclick="startReading()">LIRE</button>
            <button onclick="stopReading()">STOP</button>
            <button class="btn-nav" onclick="changePage(1)">→</button>
        </div>
    </footer>

    <script>
        const data = [
            // A. DEVISE ET SYMBOLES
            { theme: "devise", title: "La Devise Française", img: "https://formation-civique.interieur.gouv.fr/fiches-par-thematiques/principes-et-valeurs-de-la-republique/devise-et-symboles-de-la-republique/la-devise-francaise/marianne-devise.png", text: "La devise de la République est Liberté, Égalité, Fraternité. Elle est inscrite dans la Constitution. La Liberté consiste à pouvoir faire tout ce qui ne nuit pas à autrui. L'Égalité signifie que la loi est la même pour tous. La Fraternité est un devoir de solidarité entre les citoyens." },
            { theme: "devise", title: "Le Drapeau Français", img: "https://upload.wikimedia.org/wikipedia/commons/c/c3/Flag_of_France.svg", text: "Le drapeau tricolore bleu, blanc, rouge est l'emblème national de la République française. Il est né de la réunion des couleurs du Roi (le blanc) et de la ville de Paris (le bleu et le rouge). Il flotte sur tous les édifices publics." },
            
            // C. LAÏCITÉ
            { theme: "laicite", title: "Le Principe de Laïcité", img: "https://formation-civique.interieur.gouv.fr/fiches-par-thematiques/principes-et-valeurs-de-la-republique/la-laicite/la-laicite-principe-de-liberte/laicite-img.png", text: "La France est une République laïque. La laïcité garantit la liberté de conscience : chacun est libre de croire ou de ne pas croire. Elle sépare les religions de l'État. L'État ne reconnaît, ne salarie, ni ne subventionne aucun culte." },
            
            // D. LANGUE
            { theme: "langue", title: "La Langue de la République", img: "https://formation-civique.interieur.gouv.fr/fiches-par-thematiques/principes-et-valeurs-de-la-republique/la-langue-de-la-republique/langue-img.png", text: "L'article 2 de la Constitution dispose que la langue de la République est le français. C'est un lien fondamental d'unité du peuple français et un outil indispensable pour l'intégration des étrangers souhaitant s'installer durablement en France." },
            
            // E. CONTRAT ENGAGEMENT
            { theme: "contrat", title: "Le Contrat d'Engagement", img: "https://formation-civique.interieur.gouv.fr/fiches-par-thematiques/principes-et-valeurs-de-la-republique/contrat-dengagement-republicain/engagement-img.png", text: "Le contrat d'engagement républicain est souscrit par les associations qui sollicitent des subventions publiques. Elles s'engagent à respecter les principes de liberté, d'égalité, de fraternité, à ne pas remettre en cause le caractère laïque de la République et à respecter l'ordre public." }
        ];

        let filtered = [];
        let index = 0;
        let synth = window.speechSynthesis;
        let speech = new SpeechSynthesisUtterance();

        function initApp() {
            document.getElementById('welcome-screen').style.display = 'none';
            // Force le chargement des voix
            synth.getVoices();
            filterTheme();
        }

        function filterTheme() {
            const selected = document.getElementById('theme-select').value;
            filtered = data.filter(d => d.theme === selected);
            index = 0;
            display();
        }

        function display() {
            if (filtered.length === 0) return;
            const item = filtered[index];
            document.getElementById('current-title').textContent = item.title;
            const img = document.getElementById('main-img');
            img.src = item.img;
            img.style.display = 'block';
            
            const words = item.text.split(' ');
            document.getElementById('content-area').innerHTML = words.map((w, i) => `<span id="word-${i}">${w}</span>`).join(' ');
            synth.cancel();
        }

        function startReading() {
            synth.cancel();
            speech = new SpeechSynthesisUtterance(filtered[index].text);
            
            // Sélection Voix Haute Qualité
            const voices = synth.getVoices();
            const bestVoice = voices.find(v => v.lang.includes('fr') && (v.name.includes('Google') || v.name.includes('Premium'))) || voices.find(v => v.lang.includes('fr'));
            
            speech.voice = bestVoice;
            speech.lang = 'fr-FR';
            speech.rate = 0.92;

            speech.onboundary = (event) => {
                if (event.name === 'word') {
                    const charCount = event.charIndex;
                    const wordIdx = filtered[index].text.substring(0, charCount).trim().split(/\s+/).length - 1;
                    
                    document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
                    const span = document.getElementById(`word-${wordIdx >= 0 ? wordIdx : 0}`);
                    if (span) {
                        span.classList.add('highlight');
                        span.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            };
            synth.speak(speech);
        }

        function stopReading() { synth.cancel(); }
        function changePage(d) {
            index = (index + d + filtered.length) % filtered.length;
            display();
        }

        window.speechSynthesis.onvoiceschanged = () => synth.getVoices();
    </script>
</body>
</html>
